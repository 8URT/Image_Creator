# Nginx configuration for Image Creator
# This adds a location block to the existing tools.lemauricienltd.com server
# OR can be used as a separate server block if using a subdomain

# Option 1: Add this location block to the existing tracking-server config
# This routes /image_creator to the Image Creator app

location /image_creator {
    proxy_pass http://127.0.0.1:8000;
    
    # Proxy headers for proper request handling
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # Timeouts
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Buffer settings
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    
    # Increase body size for image uploads
    client_max_body_size 10M;
}

location /layout_creator {
    proxy_pass http://127.0.0.1:8000;
    
    # Proxy headers for proper request handling
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # Timeouts
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Buffer settings
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    
    # Increase body size for image uploads (up to 6 images)
    client_max_body_size 10M;
}

# Static files for Image Creator
location /static {
    alias /home/imagecreator/Image_Creator/app/static;
    expires 30d;
    add_header Cache-Control "public, immutable";
}

# Option 2: If you want a separate subdomain, use this server block instead:
# server {
#     listen 80;
#     server_name image-creator.lemauricienltd.com;
# 
#     # Security headers (same as other servers)
#     add_header X-Content-Type-Options "nosniff" always;
#     add_header X-Frame-Options "DENY" always;
#     add_header X-XSS-Protection "1; mode=block" always;
#     add_header Referrer-Policy "strict-origin-when-cross-origin" always;
#     add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
#     server_tokens off;
# 
#     # Logging
#     access_log /var/log/nginx/image-creator-access.log;
#     error_log /var/log/nginx/image-creator-error.log;
# 
#     # Client body size limit for image uploads
#     client_max_body_size 10M;
# 
#     location / {
#         proxy_pass http://127.0.0.1:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header X-Forwarded-Host $host;
#         proxy_set_header X-Forwarded-Port $server_port;
#         
#         proxy_connect_timeout 60s;
#         proxy_send_timeout 60s;
#         proxy_read_timeout 60s;
#         
#         proxy_buffering on;
#         proxy_buffer_size 4k;
#         proxy_buffers 8 4k;
#     }
# 
#     location /static {
#         alias /home/imagecreator/Image_Creator/app/static;
#         expires 30d;
#         add_header Cache-Control "public, immutable";
#     }
# 
#     location ~ /\. {
#         deny all;
#         access_log off;
#         log_not_found off;
#     }
# }
